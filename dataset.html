<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Page Template</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
</head>
<body>

<div class="container">

    <h2>Time</h2>
    <div class="row align-items-center">
        <div class="col-sm-2"><p id="value-time"></p></div>
        <div class="col-sm"><div id="slider-time"></div></div>
    </div>

</div>

<script type="text/javascript" src="data/congocountries.js"></script>
<script src="js/moment.min.js"></script>
<script type="text/javascript">



/*
    var rowConverter = function (d) {
        return {
            report_date: d.report_date, //No conversion
            province: d.province,
            health_zone: d.health_zone,
            confirmed_cases: d.confirmed_cases
        };
    };

    d3.json("data/csvjson.json", rowConverter, function (data) {
        d3.select("body").selectAll("p")
            .data(data)
            .enter()
            .append("p")
            .text(function (d) {
                if (d.confirmed_cases>100)
                    console.log(d.report_date+","+d.province+","+d.health_zone+"||"+d.confirmed_cases);

            })
    });
*/


/*
function data(test) {
    for (let j = 0; j < statesData.features.length; j++)
    {
       // statesData.features[0].properties.confirmed_case = test;

    }

   // console.log("BELIJAT: "+statesData.features[14].properties.name);

}
*/

// Time
var dataTime = d3.range(0, 4).map(function(d) {
    return new Date(2017 + d, 1, 1);
});

var sliderTime = d3
    .sliderBottom()
    .min(d3.min(dataTime))
    .max(d3.max(dataTime))
    .step(1000 * 60 * 60 * 24 * 365)
    .width(300)
    .tickFormat(d3.timeFormat('%Y'))
    .tickValues(dataTime)
    .default(new Date(2017, 1, 1))
    .on('start', val => {
        d3.select('p#value-time').text(d3.timeFormat('%Y')(val));
        let yWrapper = moment(val).format("YYYY");
        console.log("JERRYYY: " +yWrapper);
        sortData("North Kivu", yWrapper, "07");

    });




var gTime = d3
    .select('div#slider-time')
    .append('svg')
    .attr('width', 500)
    .attr('height', 100)
    .append('g')
    .attr('transform', 'translate(30,30)');

gTime.call(sliderTime);

d3.select('p#value-time').text(d3.timeFormat('%Y')(sliderTime.value()));


let summe = 0;
//sortData("Ituri", "2019", "07");
function sortData(pro, year, month){

    d3.json("data/csvjson.json", function(json) {

        for (let i = 0; i < json.length; i++){
            // statesData.features[j].properties.confirmed_case = 0;
            if (json[i].confirmed_cases>500){
                let d = new Date(json[i].report_date);
                let dayWrapper = moment(d).format("DD");
                let monthWrapper = moment(d).format("MM");
                let yearWrapper = moment(d).format("YYYY");
                let datum = moment(d).format("DD-MM-YYYY");
                // console.log("Datum: " +dayWrapper + "-" + monthWrapper + "-" + yearWrapper + " == " + json[i].province)
                if(json[i].province === pro && yearWrapper === year && monthWrapper === month){

                    summe += json[i].confirmed_cases;

                    //console.log(statesData.features[j].properties.confirmed_cases)

                    //  console.log(json[i].confirmed_cases + "==" + datum + " " + json[i].province);

                }
            }
        }
        //data(summe);
        console.log(summe)
    });
}


</script>
</body>
</html>